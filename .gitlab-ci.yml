stages:
  - Test
  - CodeCov
  # - Deploy

pytest:
  stage: Test
  image: "python:3.9.7"
  before_script:
  - apt-get update
  - apt-get install -y python3-pyqt5
  - python --version
  - pip install -e .[full]
  - pip install pytest
  - pip install pytest-cov
  - pip install pytest-qt
  script:
    - pytest -l ./apptests --cov-report term --cov=.

sonarcloud-check:
  stage: CodeCov
  variables:
    SONAR_USER_HOME: "${CI_PROJECT_DIR}/.sonar"  # Defines the location of the analysis task cache
    GIT_DEPTH: "0"  # Tells git to fetch all the branches of the project, required by the analysis task
  image:
    name: sonarsource/sonar-scanner-cli:latest
    entrypoint: [""]
  cache:
    key: "${CI_JOB_NAME}"
    paths:
      - .sonar/cache
  script:
    - sonar-scanner
  only:
    - main
    - development


# pypi:
#   stage: Deploy
#   when: manual
#   variables:
#     TWINE_USERNAME: $TWINE_USERNAME
#     TWINE_PASSWORD: $TWINE_PASSWORD
#   script:
#     - pip install -U twine
#     - python setup.py sdist bdist_wheel
#     - python -m twine upload --skip-existing dist/*
